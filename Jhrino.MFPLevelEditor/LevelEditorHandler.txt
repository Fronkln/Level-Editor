using System;
using System.Collections;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography;
using UnityEngine;
using UnityEngine.Networking;
using UnityEngine.PostProcessing;
using UnityEngine.UI;

namespace Jhrino.MFPLevelEditor
{
	// Token: 0x020000E1 RID: 225
	public class LevelEditorHandler : MonoBehaviour
	{
		// Token: 0x06000615 RID: 1557
		private void Update()
		{
			if (Input.GetKeyDown(KeyCode.P))
			{
				this.PlayMode();
				this.PrototypeSave();
			}
			if (Input.GetKeyDown(KeyCode.N) && !this.PlayMod)
			{
				this.PrototypeLoad();
			}
			if (Input.GetKeyDown(KeyCode.M) && !this.PlayMod)
			{
				this.PrototypeSave();
			}
			if (this.PlayMod)
			{
				LevelEditorHandler.levelTimer += Time.timeScale;
				if ((double)this.Player.GetComponent<PlayerScript>().health < 0.02)
				{
					LevelEditorHandler.PlayerisDeadAndForceAutoLoad = true;
				}
			}
			if (!this.PlayMod)
			{
				if (this.Editing)
				{
					this.EditingMode();
				}
				RaycastHit raycastHit;
				if (Input.GetMouseButtonDown(0) && !this.Editing && !this.adjustingSettings && Physics.Raycast(this.EditorCamera.ScreenPointToRay(Input.mousePosition), out raycastHit))
				{
					this.EnterEditMode(raycastHit.transform.gameObject);
				}
				if (Input.GetKeyDown(KeyCode.T) && !this.Editing)
				{
					GameObject gameObject = GameObject.CreatePrimitive(PrimitiveType.Cube);
					gameObject.GetComponent<MeshRenderer>().material.mainTexture = this.DefaultTexture;
					gameObject.GetComponent<MeshRenderer>().material.color = new Color(2f, 2f, 5f);
					gameObject.AddComponent<TextureTilingController>();
					gameObject.layer = 8;
					gameObject.transform.position = new Vector3(this.EditorCamera.transform.position.x, this.EditorCamera.transform.position.y, this.EditorCamera.transform.position.z + 2.5f);
					this.BrushLump.Add(gameObject);
					this.EnterEditMode(gameObject);
				}
				if (Input.GetKeyDown(KeyCode.K) && !this.Editing)
				{
					GameObject gameObject2 = GameObject.CreatePrimitive(PrimitiveType.Sphere);
					UnityEngine.Object.Destroy(gameObject2.GetComponent<SphereCollider>());
					gameObject2.AddComponent<CapsuleCollider>();
					gameObject2.layer = 8;
					gameObject2.transform.localScale = new Vector3(gameObject2.transform.localScale.x, 4f, gameObject2.transform.localScale.x);
					gameObject2.transform.position = new Vector3(this.EditorCamera.transform.position.x, this.EditorCamera.transform.position.y, -0.1f);
					gameObject2.GetComponent<MeshRenderer>().material.color = new Color(1f, 0f, 0f);
					this.EnemySpawnpoints.Add(gameObject2.transform);
					this.EnterEditMode(gameObject2);
				}
			}
		}

		// Token: 0x06000616 RID: 1558
		public LevelEditorHandler()
		{
		}

		// Token: 0x06000617 RID: 1559
		private void Start()
		{
			this.LoadEditorAssets();
			if (!Directory.Exists(MFPEditorUtils.LoadFileFromDataFolder("default")))
			{
				Directory.CreateDirectory(MFPEditorUtils.LoadFileFromDataFolder("Levels/default"));
			}
			this.root = GameObject.Find("Root").GetComponent<RootScript>();
			UnityEngine.Object.FindObjectOfType<OptimizerScript>().enabled = false;
			this.root.nrOfEnemiesTotal = 0;
			this.HUD = GameObject.Find("HUD/Canvas");
			this.Player = GameObject.Find("Player");
			this.Camera = GameObject.Find("Main Camera");
			this.Player.SetActive(false);
			this.Camera.SetActive(false);
			this.HUD.GetComponentInChildren<Canvas>().enabled = false;
			this.EnemySample = GameObject.Find("New Enemy");
			this.EnemySample.SetActive(false);
			GameObject gameObject = GameObject.CreatePrimitive(PrimitiveType.Cube);
			gameObject.layer = 8;
			gameObject.transform.position = new Vector3(0f, -1f, 0f);
			gameObject.transform.localScale = new Vector3(5f, 1f, 7f);
			gameObject.GetComponent<MeshRenderer>().material.color = new Color32(byte.MaxValue, byte.MaxValue, byte.MaxValue, byte.MaxValue);
			gameObject.AddComponent<TextureTilingController>();
			gameObject.GetComponent<MeshRenderer>().material.mainTexture = this.DefaultTexture;
			gameObject.GetComponent<MeshRenderer>().material.mainTexture.name = "EditorAssets/dev_measuregeneric01b.png";
			this.BrushLump.Add(gameObject);
			GameObject gameObject2 = new GameObject();
			gameObject2.name = "EditorCamera";
			this.EditorCamera = gameObject2.AddComponent<Camera>();
			this.EditorCamera.gameObject.AddComponent<PostProcessingBehaviour>();
			this.EditorCamera.gameObject.GetComponent<PostProcessingBehaviour>().profile = this.Camera.GetComponent<PostProcessingBehaviour>().profile;
			this.EditorCamera.depth = -1f;
			this.EditorCamera.clearFlags = CameraClearFlags.Depth;
			this.EditorCamera.transform.position = new Vector3(0f, 0f, -3f);
			GameObject gameObject3 = new GameObject();
			gameObject3.transform.position = new Vector3(0f, 0f, -15f);
			CameraMovement cameraMovement = gameObject3.AddComponent<CameraMovement>();
			cameraMovement.normalSpeed = 5f;
			cameraMovement.runSpeed = 5f;
			cameraMovement.doMove = true;
			cameraMovement.crouch = false;
			cameraMovement.cam = gameObject2.transform;
			gameObject2.transform.parent = gameObject3.transform;
			this.SpawnEditorHud();
			LevelEditorHandler.Inst = this;
			GameObject gameObject4 = GameObject.CreatePrimitive(PrimitiveType.Sphere);
			UnityEngine.Object.Destroy(gameObject4.GetComponent<SphereCollider>());
			gameObject4.AddComponent<CapsuleCollider>();
			gameObject4.transform.localScale = new Vector3(gameObject4.transform.localScale.x, 4f, gameObject4.transform.localScale.x);
			gameObject4.name = "PlayerSpawn";
			GameObject gameObject5 = GameObject.CreatePrimitive(PrimitiveType.Cube);
			gameObject5.transform.position = new Vector3(5f, 0f, 0f);
			gameObject5.transform.localScale = new Vector3(1f, 1f, 4f);
			gameObject5.name = "MFPEditor_End_Level";
			gameObject5.AddComponent<LevelChangerScript>();
			gameObject5.GetComponent<MeshRenderer>().material.color = Color.green;
			this.FinishLevelTrigger = gameObject5;
			this.PlayerSpawn = gameObject4.transform;
			this.PlayerSpawn.transform.GetComponent<MeshRenderer>().material.color = new Color(1f, 0.5f, 1f);
			this.PlayerSpawn.transform.position = new Vector3(0f, 1f, 0f);
			this.PlayMod = false;
			List<string> list = new List<string>();
			foreach (Transform transform in UnityEngine.Object.FindObjectsOfType<Transform>())
			{
				list.Add(transform.name);
			}
			if (LevelEditorHandler.PlayerisDeadAndForceAutoLoad)
			{
				this.PrototypeLoad();
				LevelEditorHandler.PlayerisDeadAndForceAutoLoad = false;
			}
			File.WriteAllLines("F:\\steamapps2\\steamapps\\common\\My Friend Pedro\\jhrino_log.txt", list.ToArray());
		}

		// Token: 0x06000618 RID: 1560
		public void ChangeCameraState(LevelEditorHandler.CameraMode state, bool editorCamera)
		{
			if (state != LevelEditorHandler.CameraMode.Disabled)
			{
				if (state != LevelEditorHandler.CameraMode.Enabled)
				{
					return;
				}
				if (!this.EditorCamera)
				{
					this.Camera.GetComponent<Camera>().enabled = true;
					return;
				}
				this.EditorCamera.enabled = true;
				return;
			}
			else
			{
				if (!this.EditorCamera)
				{
					this.Camera.GetComponent<Camera>().enabled = false;
					return;
				}
				this.EditorCamera.enabled = true;
				return;
			}
		}

		// Token: 0x06000619 RID: 1561
		public void SpawnEditorHud()
		{
			GameObject gameObject = new GameObject();
			gameObject.layer = 5;
			gameObject.name = "Canvus";
			RectTransform rectTransform = gameObject.AddComponent<RectTransform>();
			rectTransform.anchorMin = new Vector2(0.5f, 0f);
			rectTransform.anchorMax = new Vector2(0.5f, 0f);
			Canvas canvas = gameObject.AddComponent<Canvas>();
			canvas.renderMode = RenderMode.ScreenSpaceOverlay;
			canvas.pixelPerfect = false;
			canvas.targetDisplay = 0;
			canvas.additionalShaderChannels = AdditionalCanvasShaderChannels.None;
			CanvasScaler canvasScaler = gameObject.AddComponent<CanvasScaler>();
			canvasScaler.uiScaleMode = CanvasScaler.ScaleMode.ScaleWithScreenSize;
			canvasScaler.screenMatchMode = CanvasScaler.ScreenMatchMode.MatchWidthOrHeight;
			canvasScaler.referenceResolution = new Vector2(1920f, 1080f);
			canvasScaler.scaleFactor = 0.5f;
			canvasScaler.referencePixelsPerUnit = 100f;
			gameObject.AddComponent<GraphicRaycaster>().ignoreReversedGraphics = true;
			GameObject gameObject5 = new GameObject();
			gameObject5.transform.parent = gameObject.transform;
			gameObject5.layer = 5;
			gameObject5.AddComponent<RectTransform>();
			gameObject5.GetComponent<RectTransform>().pivot = new Vector2(0.5f, 0.5f);
			gameObject5.GetComponent<RectTransform>().anchorMin = new Vector2(0.5f, 0f);
			gameObject5.GetComponent<RectTransform>().anchorMax = new Vector2(0.5f, 0f);
			Text text = gameObject5.AddComponent<Text>();
			Material material = new Material(Shader.Find("UI/Default"));
			text.material = material;
			text.text = "GAME OVER";
			text.font = (Resources.GetBuiltinResource(typeof(Font), "Arial.ttf") as Font);
			text.fontStyle = FontStyle.Bold;
			text.fontSize = 68;
			text.lineSpacing = 1f;
			text.supportRichText = false;
			text.alignment = TextAnchor.MiddleCenter;
			text.horizontalOverflow = HorizontalWrapMode.Overflow;
			text.verticalOverflow = VerticalWrapMode.Overflow;
			text.resizeTextForBestFit = false;
			text.alignByGeometry = false;
			text.GetComponent<RectTransform>().sizeDelta = new Vector2(472.9f, 100f);
			this.DebugObject = text;
			gameObject5.GetComponent<RectTransform>().anchoredPosition = new Vector2(-45.6f, 83f);
			new GameObject();
			GameObject gameObject2 = new GameObject();
			gameObject2.name = "CoordinateField";
			gameObject2.AddComponent<RectTransform>();
			gameObject2.transform.parent = gameObject.transform;
			gameObject2.layer = 5;
			gameObject2.AddComponent<RectTransform>();
			gameObject2.GetComponent<RectTransform>().pivot = new Vector2(0.5f, 0.5f);
			gameObject2.GetComponent<RectTransform>().anchorMin = new Vector2(0.5f, 0f);
			gameObject2.GetComponent<RectTransform>().anchorMax = new Vector2(0.5f, 0f);
			gameObject2.GetComponent<RectTransform>().anchoredPosition = new Vector2(-20f, 173.8f);
			Image image = gameObject2.AddComponent<Image>();
			image.sprite = (Resources.GetBuiltinResource(typeof(Sprite), "InputFieldBackground") as Sprite);
			image.raycastTarget = true;
			InputField inputField = gameObject2.AddComponent<InputField>();
			this.CoordinateField = inputField;
			inputField.interactable = true;
			inputField.transition = Selectable.Transition.ColorTint;
			inputField.targetGraphic = image;
			inputField.textComponent = this.DebugObject;
			inputField.contentType = InputField.ContentType.Standard;
			inputField.lineType = InputField.LineType.SingleLine;
			inputField.caretBlinkRate = 0.85f;
			inputField.caretWidth = 1;
			inputField.shouldHideMobileInput = true;
			inputField.readOnly = false;
			gameObject2.transform.parent = gameObject.transform;
			this.DebugObject.transform.parent = gameObject2.transform;
			inputField.gameObject.SetActive(false);
			GameObject gameObject3 = new GameObject();
			gameObject3.transform.parent = gameObject.transform;
			gameObject3.layer = 5;
			gameObject3.AddComponent<RectTransform>();
			gameObject3.GetComponent<RectTransform>().pivot = new Vector2(0.5f, 0.5f);
			gameObject3.GetComponent<RectTransform>().anchorMin = new Vector2(1f, 1f);
			gameObject3.GetComponent<RectTransform>().anchorMax = new Vector2(1f, 1f);
			Image targetGraphic = gameObject3.AddComponent<Image>();
			gameObject3.GetComponent<RectTransform>().anchoredPosition = new Vector2(-128f, -122f);
			Button button = gameObject3.AddComponent<Button>();
			button.transition = Selectable.Transition.ColorTint;
			button.targetGraphic = targetGraphic;
			button.interactable = true;
			gameObject3.GetComponent<RectTransform>().anchoredPosition = new Vector2(-128f, -122f);
			Texture2D ico_pos = MFPEditorUtils.LoadPNG(MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/icons/ico_position.png"));
			Sprite spr_pos = Sprite.Create(ico_pos, new Rect(0f, 0f, (float)ico_pos.width, (float)ico_pos.height), new Vector2(0f, 0f), 100f);
			targetGraphic.sprite = spr_pos;
			button.onClick.AddListener(delegate()
			{
				this.ChangeEditType("position");
			});
			GameObject gameObject6 = new GameObject();
			gameObject6.transform.parent = gameObject.transform;
			gameObject6.layer = 5;
			gameObject6.AddComponent<RectTransform>();
			gameObject6.GetComponent<RectTransform>().pivot = new Vector2(0.5f, 0.5f);
			gameObject6.GetComponent<RectTransform>().anchorMin = new Vector2(1f, 1f);
			gameObject6.GetComponent<RectTransform>().anchorMax = new Vector2(1f, 1f);
			Image targetGraphic2 = gameObject6.AddComponent<Image>();
			gameObject6.GetComponent<RectTransform>().anchoredPosition = new Vector2(-128f, -255.9f);
			Button button2 = gameObject6.AddComponent<Button>();
			Texture2D ico_rot = MFPEditorUtils.LoadPNG(MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/icons/ico_rotation.png"));
			Sprite spr_rot = Sprite.Create(ico_rot, new Rect(0f, 0f, (float)ico_rot.width, (float)ico_rot.height), new Vector2(0f, 0f), 100f);
			targetGraphic2.sprite = spr_rot;
			button2.transition = Selectable.Transition.ColorTint;
			button2.targetGraphic = targetGraphic2;
			button2.interactable = true;
			button2.onClick.AddListener(delegate()
			{
				this.ChangeEditType("rotation");
			});
			GameObject gameObject7 = new GameObject();
			gameObject7.transform.parent = gameObject.transform;
			gameObject7.layer = 5;
			gameObject7.AddComponent<RectTransform>();
			gameObject7.GetComponent<RectTransform>().pivot = new Vector2(0.5f, 0.5f);
			gameObject7.GetComponent<RectTransform>().anchorMin = new Vector2(1f, 1f);
			gameObject7.GetComponent<RectTransform>().anchorMax = new Vector2(1f, 1f);
			Image targetGraphic3 = gameObject7.AddComponent<Image>();
			gameObject7.GetComponent<RectTransform>().anchoredPosition = new Vector2(-128f, -400f);
			Button button3 = gameObject7.AddComponent<Button>();
			Texture2D ico_sca = MFPEditorUtils.LoadPNG(MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/icons/ico_scale.png"));
			Sprite spr_sca = Sprite.Create(ico_sca, new Rect(0f, 0f, (float)ico_sca.width, (float)ico_sca.height), new Vector2(0f, 0f), 100f);
			targetGraphic3.sprite = spr_sca;
			button3.transition = Selectable.Transition.ColorTint;
			button3.targetGraphic = targetGraphic3;
			button3.interactable = true;
			button3.onClick.AddListener(delegate()
			{
				this.ChangeEditType("scale");
			});
			GameObject gameObject4 = new GameObject();
			gameObject4.transform.parent = gameObject.transform;
			gameObject4.layer = 5;
			gameObject4.AddComponent<RectTransform>();
			gameObject4.GetComponent<RectTransform>().pivot = new Vector2(0.5f, 0.5f);
			gameObject4.GetComponent<RectTransform>().anchorMin = new Vector2(1f, 1f);
			gameObject4.GetComponent<RectTransform>().anchorMax = new Vector2(1f, 1f);
			gameObject4.AddComponent<Image>();
			gameObject4.GetComponent<RectTransform>().anchoredPosition = new Vector2(-128f, -550f);
			Button button4 = gameObject4.AddComponent<Button>();
			Texture2D ico_col = MFPEditorUtils.LoadPNG(MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/icons/ico_color.png"));
			Sprite spr_col = Sprite.Create(ico_col, new Rect(0f, 0f, (float)ico_col.width, (float)ico_col.height), new Vector2(0f, 0f), 100f);
			gameObject4.GetComponent<Image>().sprite = spr_col;
			button4.transition = Selectable.Transition.ColorTint;
			button4.targetGraphic = gameObject4.GetComponent<Image>();
			button4.interactable = true;
			button4.onClick.AddListener(delegate()
			{
				this.ChangeEditType("color");
			});
			this.EditorButtonsRoot = new GameObject();
			this.EditorButtonsRoot.transform.parent = canvas.transform;
			gameObject3.transform.parent = this.EditorButtonsRoot.transform;
			gameObject4.transform.parent = this.EditorButtonsRoot.transform;
			gameObject7.transform.parent = this.EditorButtonsRoot.transform;
			gameObject6.transform.parent = this.EditorButtonsRoot.transform;
			GameObject PanelOBJ = new GameObject();
			PanelOBJ.transform.parent = gameObject.transform;
			PanelOBJ.name = "EntitiesListContainer";
			Image Panel = PanelOBJ.AddComponent<Image>();
			Panel.color = new Color(Panel.color.r, Panel.color.b, Panel.color.b, 0.3921569f);
			RectTransform component = PanelOBJ.GetComponent<RectTransform>();
			component.anchorMin = new Vector2(0.5f, 0.5f);
			component.anchorMax = new Vector2(0.5f, 0.5f);
			component.pivot = new Vector2(0.5f, 0.5f);
			component.sizeDelta = new Vector2(628.2f, 440.51f);
			component.anchoredPosition = new Vector2(0f, 0f);
			GameObject gameObject8 = new GameObject();
			gameObject8.name = "PlatformLiftButton";
			gameObject8.transform.parent = PanelOBJ.transform;
			RectTransform rectTransform2 = gameObject8.AddComponent<RectTransform>();
			rectTransform2.anchorMin = new Vector2(0.5f, 0.5f);
			rectTransform2.anchorMax = new Vector2(0.5f, 0.5f);
			rectTransform2.pivot = new Vector2(0.5f, 0.5f);
			rectTransform2.sizeDelta = new Vector2(254.86f, 30f);
			rectTransform2.anchoredPosition = new Vector2(0f, 158f);
			Button plButton = gameObject8.AddComponent<Button>();
			Image plButtonGraphics = plButton.gameObject.AddComponent<Image>();
			plButton.targetGraphic = plButtonGraphics;
			GameObject gameObject9 = new GameObject();
			gameObject9.name = "PlatformLiftButtonText";
			gameObject9.transform.parent = plButton.transform;
			RectTransform plButtonRect = gameObject9.AddComponent<RectTransform>();
			plButtonRect.anchorMin = new Vector2(0f, 0f);
			plButtonRect.anchorMax = new Vector2(1f, 1f);
			plButtonRect.pivot = new Vector2(0.5f, 0.5f);
			plButtonRect.anchoredPosition = new Vector2(0f, 0f);
			Text text2 = gameObject9.AddComponent<Text>();
			text2.font = (Resources.GetBuiltinResource(typeof(Font), "Arial.ttf") as Font);
			text2.text = "Platform Lift";
			text2.alignment = TextAnchor.MiddleCenter;
			plButtonRect.localScale = new Vector3(0.45943f, 0.45943f, 0.45943f);
			text2.color = new Color(0f, 0f, 0f);
			text2.fontSize = 64;
			text2.verticalOverflow = VerticalWrapMode.Overflow;
			text2.horizontalOverflow = HorizontalWrapMode.Overflow;
			this.EntitySpawnRoot = PanelOBJ;
			GameObject PanelOBJ2 = new GameObject();
			PanelOBJ2.transform.parent = gameObject.transform;
			PanelOBJ2.name = "WorldSettingsContainer";
			Image Panel2 = PanelOBJ2.AddComponent<Image>();
			Panel2.color = new Color(Panel2.color.r, Panel2.color.b, Panel2.color.b, 0.7f);
			RectTransform component2 = PanelOBJ2.GetComponent<RectTransform>();
			component2.anchorMin = new Vector2(0.5f, 0.5f);
			component2.anchorMax = new Vector2(0.5f, 0.5f);
			component2.pivot = new Vector2(0.5f, 0.5f);
			component2.sizeDelta = new Vector2(576.2f, 447.6f);
			component2.anchoredPosition = new Vector2(0f, 0f);
			GameObject gameObject10 = new GameObject();
			gameObject10.transform.parent = PanelOBJ2.transform;
			gameObject10.name = "AllowPostProcessText";
			RectTransform pptextrect = gameObject10.AddComponent<RectTransform>();
			pptextrect.anchorMin = new Vector2(0.5f, 0.5f);
			pptextrect.anchorMax = new Vector2(0.5f, 0.5f);
			pptextrect.pivot = new Vector2(0.5f, 0.5f);
			pptextrect.anchoredPosition = new Vector2(-216f, 187f);
			pptextrect.sizeDelta = new Vector2(160f, 30f);
			Text text3 = gameObject10.AddComponent<Text>();
			text3.font = (Resources.GetBuiltinResource(typeof(Font), "Arial.ttf") as Font);
			text3.text = "Allow Post Processing:";
			text3.alignment = TextAnchor.UpperLeft;
			pptextrect.localScale = new Vector3(0.49257f, 0.49257f, 0.49257f);
			text3.color = new Color(0f, 0f, 0f);
			text3.fontSize = 64;
			text3.verticalOverflow = VerticalWrapMode.Overflow;
			text3.horizontalOverflow = HorizontalWrapMode.Overflow;
			GameObject PostProcessingCheckmark = new GameObject();
			PostProcessingCheckmark.name = "PostProcessCheckmark";
			PostProcessingCheckmark.transform.parent = PanelOBJ2.transform;
			RectTransform rectTransform3 = PostProcessingCheckmark.AddComponent<RectTransform>();
			rectTransform3.pivot = new Vector2(0.5f, 0.5f);
			rectTransform3.anchorMin = new Vector2(0.5f, 0.5f);
			rectTransform3.anchorMax = new Vector2(0.5f, 0.5f);
			rectTransform3.sizeDelta = new Vector2(20.41f, 20f);
			rectTransform3.localScale = new Vector3(1.9014f, 1.9014f, 1.9014f);
			rectTransform3.anchoredPosition = new Vector2(97.5f, 175.6f);
			Toggle toggle = PostProcessingCheckmark.AddComponent<Toggle>();
			allowPostProcessToggle = toggle;
			toggle.isOn = true;
			GameObject checkmarkbg = new GameObject();
			checkmarkbg.name = "CheckmarkBackground";
			checkmarkbg.transform.parent = PostProcessingCheckmark.transform;
			RectTransform rectTransform4 = checkmarkbg.AddComponent<RectTransform>();
			rectTransform4.pivot = new Vector2(0.5f, 0.5f);
			rectTransform4.anchorMin = new Vector2(0f, 1f);
			rectTransform4.anchorMax = new Vector2(0f, 1f);
			rectTransform4.sizeDelta = new Vector2(20f, 20f);
			rectTransform4.anchoredPosition = new Vector2(10f, -10f);
			rectTransform4.localScale = new Vector3(1f, 1f, 1f);
			Image checkmarkbgGraphics = checkmarkbg.AddComponent<Image>();
			toggle.targetGraphic = checkmarkbgGraphics;
			RectTransform rectTransform5 = new GameObject
			{
				name = "Checkmark",
				transform = 
				{
					parent = checkmarkbg.transform
				}
			}.AddComponent<RectTransform>();
			rectTransform5.pivot = new Vector2(0.5f, 0.5f);
			rectTransform5.anchorMin = new Vector2(0.5f, 0.5f);
			rectTransform5.anchorMax = new Vector2(0.5f, 0.5f);
			rectTransform5.sizeDelta = new Vector2(20f, 20f);
			rectTransform5.anchoredPosition = new Vector2(0f, 0f);
			Image checkrectimage = rectTransform5.gameObject.AddComponent<Image>();
			Texture2D ico_check = MFPEditorUtils.LoadPNG(MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/icons/checkmark.png"));
			Sprite spr_check = Sprite.Create(ico_check, new Rect(0f, 0f, (float)ico_check.width, (float)ico_check.height), new Vector2(0f, 0f), 100f);
			checkrectimage.sprite = spr_check;
			toggle.graphic = checkrectimage;
			this.WorldSettingsRoot = PanelOBJ2;
			this.WorldSettingsRoot.SetActive(false);
			GameObject gameObject11 = new GameObject();
			gameObject11.transform.parent = gameObject.transform;
			gameObject11.layer = 5;
			gameObject11.AddComponent<RectTransform>();
			gameObject11.GetComponent<RectTransform>().pivot = new Vector2(0.5f, 0.5f);
			gameObject11.GetComponent<RectTransform>().anchorMin = new Vector2(1f, 1f);
			gameObject11.GetComponent<RectTransform>().anchorMax = new Vector2(1f, 1f);
			gameObject11.AddComponent<Image>();
			gameObject11.GetComponent<RectTransform>().anchoredPosition = new Vector2(-128f, -700f);
			gameObject11.AddComponent<Button>().onClick.AddListener(delegate()
			{
				this.ToggleSettingsMenu("world", false);
			});

			toggle.onValueChanged.AddListener(delegate{AdjustPostProcessing(toggle.isOn, bloomIntensity);});

			MFPEditorLogger.Log("Hud load complete");
			this.EntitySpawnRoot.SetActive(false);
		}

		// Token: 0x0600061A RID: 1562
		public void EditingMode()
		{
			if (Input.GetKeyDown(KeyCode.L) && this.EditingObject != this.PlayerSpawn.gameObject && this.EditingObject != this.FinishLevelTrigger)
			{
				UnityEngine.Object.Destroy(this.EditingObject);
				this.Editing = false;
				this.EditingObject = null;
				this.CoordinateField.DeactivateInputField();
				this.CoordinateField.gameObject.SetActive(false);
			}
			bool isFocused = this.CoordinateField.isFocused;
			if (this.CoordinateField.isFocused)
			{
					this.UpdateCoordinates(this.editType, this.CoordinateField.text);
					return;
				
				this.ExitEditMode();
			}
		}

		// Token: 0x0600061B RID: 1563
		public void UpdateCoordinates(string type, string coordinates)
		{
			if (this.EditingObject != null)
			{
				coordinates = coordinates.Replace("(", "");
				coordinates = coordinates.Replace(")", "");
				coordinates = coordinates.Replace(",", "");
				if (this.editType != "color")
				{
					float num = float.Parse(coordinates.Split(new char[]
					{
						' '
					})[0]);
					float num2 = float.Parse(coordinates.Split(new char[]
					{
						' '
					})[1]);
					float num3 = float.Parse(coordinates.Split(new char[]
					{
						' '
					})[2]);
					if(type == "position")
					{

						CoordinateField.text = coordinates;

					}

					if (type == "rotation")
					{
						this.EditingObject.transform.eulerAngles = new Vector3(num, num2, num3);
					}
					if (type == "scale")
					{
						this.EditingObject.transform.localScale = new Vector3(num, num2, num3);
						return;
					}
				}
				else if (type == "color")
				{
					byte bit = Convert.ToByte(coordinates.Split(new char[]
					{
						' '
					})[0]);
					byte bit2 = Convert.ToByte(coordinates.Split(new char[]
					{
						' '
					})[1]);
					byte bit3 = Convert.ToByte(coordinates.Split(new char[]
					{
						' '
					})[2]);
					Color32 color255 = new Color32(bit, bit2, bit3, byte.MaxValue);
					MFPEditorLogger.Log(color255.ToString());
					this.EditingObject.GetComponent<MeshRenderer>().material.color = color255;
				}
			}
		}

		// Token: 0x0600061C RID: 1564
		public void ChangeEditType(string type)
		{
			this.ExitEditMode();
			this.editType = type;
		}

		// Token: 0x0600061D RID: 1565
		public void EnterEditMode(GameObject gobject)
		{
			this.EditingObject = gobject;
			this.CoordinateField.gameObject.SetActive(true);
			if (this.editType != "position")
			{
				this.CoordinateField.ActivateInputField();
			}
			if (this.editType == "position")
			{
				this.CoordinateField.text = gobject.transform.position.ToString();
				gobject.GetComponent<MeshRenderer>().material = StandardShaderUtils.ChangeRenderMode(gobject.GetComponent<MeshRenderer>().material, StandardShaderUtils.BlendMode.Transparent);
				Color color = gobject.GetComponent<MeshRenderer>().material.color;
				color.a = 0.5f;
				this.ToggleEditingObjectColliders(gobject, false);
				Material material = new Material(Shader.Find("Standard"));
				gobject.GetComponent<MeshRenderer>().material.color = color;
				GameObject gameObject = new GameObject();
				gameObject.name = "AxeContainer";
				gameObject.transform.parent = gobject.transform;
				GameObject gameObject2 = new GameObject();
				gameObject2.AddComponent<MeshFilter>().mesh = this.EditorAxeMesh;
				gameObject2.AddComponent<MeshRenderer>();
				gameObject2.GetComponent<MeshRenderer>().material = material;
				gameObject2.GetComponent<MeshRenderer>().material.color = new Color(1f, 0f, 0f);
				gameObject2.transform.position = gobject.transform.position;
				gameObject2.transform.eulerAngles = new Vector3(0f, 90f, 0f);
				gameObject2.AddComponent<MeshCollider>().sharedMesh = this.EditorAxeMesh;
				gameObject2.GetComponent<MeshCollider>().convex = true;
				gameObject2.AddComponent<LevelEditorAxis>().axis = LevelEditorAxis.AxisType.x;
				gameObject2.name = "X Axis";
				GameObject gameObject3 = new GameObject();
				gameObject3.AddComponent<MeshFilter>().mesh = this.EditorAxeMesh;
				gameObject3.AddComponent<MeshRenderer>();
				gameObject3.GetComponent<MeshRenderer>().material = material;
				gameObject3.GetComponent<MeshRenderer>().material.color = new Color(0f, 1f, 0f);
				gameObject3.transform.position = gobject.transform.position;
				gameObject3.transform.eulerAngles = new Vector3(90f, 0f, 0f);
				gameObject3.AddComponent<MeshCollider>().sharedMesh = this.EditorAxeMesh;
				gameObject3.GetComponent<MeshCollider>().convex = true;
				gameObject3.AddComponent<LevelEditorAxis>().axis = LevelEditorAxis.AxisType.y;
				gameObject3.name = "Y Axis";
				GameObject gameObject4 = new GameObject();
				gameObject4.AddComponent<MeshFilter>().mesh = this.EditorAxeMesh;
				gameObject4.AddComponent<MeshRenderer>();
				gameObject4.GetComponent<MeshRenderer>().material = material;
				gameObject4.GetComponent<MeshRenderer>().material.color = new Color(0f, 0f, 1f);
				gameObject4.transform.position = gobject.transform.position;
				gameObject4.AddComponent<MeshCollider>().sharedMesh = this.EditorAxeMesh;
				gameObject4.GetComponent<MeshCollider>().convex = true;
				gameObject4.AddComponent<LevelEditorAxis>().axis = LevelEditorAxis.AxisType.z;
				gameObject4.name = "Z Axis";
				gameObject2.transform.parent = gameObject.transform;
				gameObject3.transform.parent = gameObject.transform;
				gameObject4.transform.parent = gameObject.transform;
				this.EditAxes = gameObject;
			}
			if (this.editType == "rotation")
			{
				if (this.EditingObject == this.PlayerSpawn.gameObject || this.EnemySpawnpoints.Contains(this.EditingObject.transform))
				{
					this.ExitEditMode();
					this.Editing = false;
				}
				this.CoordinateField.text = gobject.transform.rotation.ToString();
			}
			if (this.editType == "scale")
			{
				if (this.EditingObject == this.PlayerSpawn.gameObject || this.EnemySpawnpoints.Contains(this.EditingObject.transform))
				{
					this.ExitEditMode();
					this.Editing = false;
				}
				this.CoordinateField.text = gobject.transform.localScale.ToString();
			}
			if (this.editType == "color")
			{
				if (this.EditingObject == this.PlayerSpawn.gameObject || this.EnemySpawnpoints.Contains(this.EditingObject.transform))
				{
					this.ExitEditMode();
					this.Editing = false;
				}
				string totext255 = gobject.GetComponent<MeshRenderer>().material.color.ToString();
				totext255 = totext255.Replace("RGBA", "");
				MFPEditorLogger.Log(totext255.ToString());
				this.CoordinateField.text = totext255;
			}
			this.Editing = true;
		}

		// Token: 0x0600061E RID: 1566
		public void PlayMode()
		{
			this.Player.transform.position = this.PlayerSpawn.transform.position;
			for (int i = this.EnemySpawnpoints.Count - 1; i > -1; i--)
			{
				if (this.EnemySpawnpoints[i] == null)
				{
					this.EnemySpawnpoints.RemoveAt(i);
				}
			}
			if (!this.PlayMod)
			{
				if (this.Editing)
				{
					this.ExitEditMode();
				}
				this.EditorButtonsRoot.SetActive(false);
				this.ToggleSettingsMenu(null, true);
				this.root.nrOfEnemiesTotal = 0;
				LevelEditorHandler.levelTimer = 0f;
				this.PlayerSpawn.GetComponent<CapsuleCollider>().enabled = false;
				this.PlayerSpawn.GetComponent<MeshRenderer>().enabled = false;
				this.Player.transform.position = this.PlayerSpawn.transform.position;
				this.HUD.GetComponentInChildren<Canvas>().enabled = true;
				this.Player.SetActive(true);
				this.Camera.SetActive(true);
				this.CoordinateField.DeactivateInputField();
				this.CoordinateField.gameObject.SetActive(false);
				this.EditorCamera.enabled = false;
				this.EditorCamera.transform.parent.GetComponent<CameraMovement>().enabled = false;
				this.PlayMod = true;
				TextureTilingController[] array = UnityEngine.Object.FindObjectsOfType<TextureTilingController>();
				for (int j = 0; j < array.Length; j++)
				{
					array[j].enabled = false;
				}
				foreach (Transform transform in this.EnemySpawnpoints)
				{
					transform.GetComponent<MeshRenderer>().enabled = false;
					transform.GetComponent<CapsuleCollider>().enabled = false;
					GameObject gameObject = UnityEngine.Object.Instantiate<GameObject>(this.EnemySample);
					this.Enemies.Add(gameObject);
					gameObject.transform.position = transform.position;
					gameObject.SetActive(true);
					this.root.nrOfEnemiesTotal++;
				}
				this.FinishLevelTrigger.GetComponent<MeshRenderer>().enabled = false;
				this.FinishLevelTrigger.GetComponent<BoxCollider>().isTrigger = true;
				this.root.nrOfEnemiesTotal = this.root.nrOfEnemiesTotal / 2;
				this.root.nrOfEnemiesTotal -= this.root.nrOfEnemiesTotal;
				this.CalculateLevelHash();
				this.root.dontAllowCheckpointSave = true;
				return;
			}
			if (this.PlayMod)
			{
				this.EditorButtonsRoot.SetActive(true);
				LevelEditorHandler.levelTimer = 0f;
				this.Player.transform.position = this.PlayerSpawn.transform.position;
				this.PlayerSpawn.GetComponent<CapsuleCollider>().enabled = true;
				this.HUD.GetComponentInChildren<Canvas>().enabled = false;
				this.Player.SetActive(false);
				this.Camera.SetActive(false);
				this.EditorCamera.enabled = true;
				this.EditorCamera.transform.parent.GetComponent<CameraMovement>().enabled = true;
				this.PlayMod = false;
				foreach (GameObject obj in this.Enemies)
				{
					UnityEngine.Object.Destroy(obj);
				}
				TextureTilingController[] array2 = UnityEngine.Object.FindObjectsOfType<TextureTilingController>();
				for (int k = 0; k < array2.Length; k++)
				{
					array2[k].enabled = true;
				}
				foreach (Transform transform2 in this.EnemySpawnpoints)
				{
					transform2.gameObject.GetComponent<MeshRenderer>().enabled = true;
					transform2.gameObject.GetComponent<CapsuleCollider>().enabled = true;
				}
				this.PlayerSpawn.GetComponent<MeshRenderer>().enabled = true;
				this.FinishLevelTrigger.GetComponent<MeshRenderer>().enabled = true;
				this.FinishLevelTrigger.GetComponent<BoxCollider>().isTrigger = false;
				this.Enemies.Clear();
			}
		}

		// Token: 0x0600061F RID: 1567
		public void ExitEditMode()
		{
			string text = this.CoordinateField.text;
			this.CoordinateField.DeactivateInputField();
			this.CoordinateField.gameObject.SetActive(false);
			if (this.EditAxes != null)
			{
				UnityEngine.Object.Destroy(this.EditAxes);
				this.EditingObject.GetComponent<MeshRenderer>().material = StandardShaderUtils.ChangeRenderMode(this.EditingObject.GetComponent<MeshRenderer>().material, StandardShaderUtils.BlendMode.Opaque);
				Color color = this.EditingObject.GetComponent<MeshRenderer>().material.color;
				color.a = 1f;
				this.EditingObject.GetComponent<MeshRenderer>().material.color = color;
			}
			this.ToggleEditingObjectColliders(this.EditingObject, true);
			this.EditingObject = null;
			this.Editing = false;
		}

		// Token: 0x06000620 RID: 1568
		public void LoadEditorAssets()
		{
			this.EditorAxeMesh = FastObjImporter.Instance.ImportFile(MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/axe.obj"));
			this.DefaultTexture = MFPEditorUtils.LoadPNG(MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/dev_measuregeneric01b.png"));
			string texname = MFPEditorUtils.LoadFileFromDataFolder("EditorAssets/dev_measuregeneric01b.png");
			texname = texname.Replace(MFPEditorUtils.LoadFileFromDataFolder(""), "");
			MFPEditorLogger.Log("Texture name is: " + texname);
			this.DefaultTexture.name = texname;
		}

		// Token: 0x06000621 RID: 1569
		public string LoadFileFromDataFolder(string file)
		{
			return Application.dataPath + "/LevelEditor_Jhrino/" + file;
		}

		// Token: 0x06000622 RID: 1570
		public void ToggleEditingObjectColliders(GameObject gobject, bool toggle)
		{
			if (gobject != null)
			{
				if (toggle)
				{
					gobject.GetComponent<Collider>();
					gobject.GetComponent<Collider>().enabled = true;
					return;
				}
				gobject.GetComponent<Collider>();
				gobject.GetComponent<Collider>().enabled = false;
			}
		}

		// Token: 0x06000623 RID: 1571
		public void PrototypeSave()
		{
			for (int i = this.EnemySpawnpoints.Count - 1; i > -1; i--)
			{
				if (this.EnemySpawnpoints[i] == null)
				{
					this.EnemySpawnpoints.RemoveAt(i);
				}
			}
			for (int j = this.BrushLump.Count - 1; j > -1; j--)
			{
				if (this.BrushLump[j] == null)
				{
					this.BrushLump.RemoveAt(j);
				}
			}
			List<string> SavedLevel = new List<string>();
			string item = this.PlayerSpawn.position.ToString().Replace("(", "").Replace(")", "").Replace(",", "");
			string item2 = this.FinishLevelTrigger.transform.position.ToString().Replace("(", "").Replace(")", "").Replace(",", "");
			SavedLevel.Add("!World");
			SavedLevel.Add("allowPostProcess = " + this.allowPostProcess.ToString());
			SavedLevel.Add("bloomIntensity = " + this.Camera.GetComponent<PostProcessingBehaviour>().profile.bloom.settings.bloom.intensity.ToString());
			SavedLevel.Add("theme = " + this.theme);
			SavedLevel.Add("!Player");
			SavedLevel.Add(item);
			SavedLevel.Add("!LevelEnd");
			SavedLevel.Add(item2);
			SavedLevel.Add(this.FinishLevelTrigger.transform.localScale.ToString().Replace("(", "").Replace(")", "").Replace(",", ""));
			MFPEditorLogger.Log("player coordinates added");
			MFPEditorLogger.Log("----");
			int num = 2;
			while (this.EnemySpawnpoints.ElementAtOrDefault(num - 2) != null)
			{
				string text = this.EnemySpawnpoints[num - 2].transform.position.ToString().Replace("(", "").Replace(")", "").Replace(",", "");
				SavedLevel.Add("!EnemySpawn");
				SavedLevel.Add(text);
				MFPEditorLogger.Log("added coordinate " + text);
				num++;
			}
			MFPEditorLogger.Log("----");
			foreach (GameObject lump in this.BrushLump)
			{
				SavedLevel.Add("!Brush");
				SavedLevel.Add(lump.transform.position.ToString().Replace("(", "").Replace(")", "").Replace(",", ""));
				SavedLevel.Add(lump.transform.rotation.ToString().Replace("(", "").Replace(")", "").Replace(",", ""));
				SavedLevel.Add(lump.transform.localScale.ToString().Replace("(", "").Replace(")", "").Replace(",", ""));
				SavedLevel.Add(lump.GetComponent<MeshRenderer>().material.color.ToString().Replace("(", "").Replace(")", "").Replace(",", "").Replace("RGBA", ""));
				SavedLevel.Add(lump.layer.ToString());
				SavedLevel.Add(lump.GetComponent<MeshRenderer>().material.mainTexture.name);
			}
			File.WriteAllLines(MFPEditorUtils.LoadFileFromDataFolder("Levels/default/level.txt"), SavedLevel.ToArray());
			this.CalculateLevelHash();
			MFPEditorLogger.Log("----");
		}

		// Token: 0x06000624 RID: 1572
public void PrototypeLoad()
		{
			if (this.Editing)
			{
				this.ExitEditMode();
			}
			string[] levelFile = File.ReadAllLines(MFPEditorUtils.LoadFileFromDataFolder("Levels/default/level.txt"));


			foreach (GameObject obj in this.BrushLump)
			{
				UnityEngine.Object.Destroy(obj);
			}
			for (int i = this.EnemySpawnpoints.Count - 1; i > -1; i--)
			{
				if (this.EnemySpawnpoints[i] == null)
				{
					this.EnemySpawnpoints.RemoveAt(i);
				}
			}
			for (int j = this.BrushLump.Count - 1; j > -1; j--)
			{
				if (this.BrushLump[j] == null)
				{
					this.BrushLump.RemoveAt(j);
				}
			}
			foreach (Transform transform in this.EnemySpawnpoints)
			{
				UnityEngine.Object.Destroy(transform.gameObject);
			}
			MFPEditorLogger.Log("Loading File");
			MFPEditorLogger.Log("------------");
			string[] array = new string[]
			{
				"!Brush",
				"!PlayerSpawn",
				"!EnemySpawn",
				"!LevelEnd"
			};
        for (int i = 0; i < levelFile.Length; i++) //WE'RE JUST GONNA READ THE WHOLE THING
        {
            String tag = levelFile[i]; //It SHOULD only hit this line if its a tag
            switch (tag)
            {
				case "!World":
					if(levelFile[i + 1].Contains ("True"))
					{
							allowPostProcess = true;
							MFPEditorLogger.Log("Post processing is enabled");
					}
					if(levelFile[i + 1].Contains("False"))
					{
							allowPostProcess = false;
							MFPEditorLogger.Log("Post processing is disabled");

					}
					float bloomIntensity = float.Parse(levelFile[i + 2].Replace("bloomIntensity = ", ""));

						AdjustPostProcessing(allowPostProcess, bloomIntensity);

						allowPostProcessToggle.isOn = allowPostProcess;

					theme = int.Parse(levelFile[i + 3].Replace("theme = ", ""));
						root.theme = theme;

					i += 3;
					break;

                case "!Brush": //ITS A BRUSH
                    //These basically just grab the correct line, split it into an array, and parse it to a float array in 1 line
                    float[] position = Array.ConvertAll(levelFile[i + 1].Split(new char[] { ' ' }), float.Parse);
                    float[] rotation = Array.ConvertAll(levelFile[i + 2].Split(new char[] { ' ' }), float.Parse);
                    float[] scale = Array.ConvertAll(levelFile[i + 3].Split(new char[] { ' ' }), float.Parse);
                    float[] color = Array.ConvertAll(levelFile[i + 4].Split(new char[] { ' ' }), float.Parse);
                    int property = int.Parse(levelFile[i + 5]);
                    string texturename = levelFile[i + 6];

                    GameObject newBrush = GameObject.CreatePrimitive(PrimitiveType.Cube);
                    newBrush.transform.position = new Vector3(position[0], position[1], position[2]);
                    newBrush.transform.rotation = new Quaternion(rotation[0], rotation[1], rotation[2], rotation[3]);
                    newBrush.transform.localScale = new Vector3(scale[0], scale[1], scale[2]);
                    newBrush.GetComponent<MeshRenderer>().material.color = new Color(color[0], color[1], color[2]);
					newBrush.GetComponent<MeshRenderer>().material.mainTexture = MFPEditorUtils.LoadPNG(MFPEditorUtils.LoadFileFromDataFolder(texturename));
					newBrush.GetComponent<MeshRenderer>().material.mainTexture.name = texturename;
					newBrush.AddComponent<TextureTilingController>();
                    newBrush.layer = property;
                    this.BrushLump.Add(newBrush);

                    i += 6;
                    break;

                case "!PlayerSpawn":
                    float[] playerposition = Array.ConvertAll(levelFile[i + 1].Split(new char[] { ' ' }), float.Parse);

                    this.PlayerSpawn.position = new Vector3(playerposition[0], playerposition[1], playerposition[2]);

                    i++;
                    break;

                case "!EnemySpawn":
                    float[] enemyposition = Array.ConvertAll(levelFile[i + 1].Split(new char[] { ' ' }), float.Parse);

                    GameObject gameObject3 = GameObject.CreatePrimitive(0);
                    Destroy(gameObject3.GetComponent<SphereCollider>());
                    gameObject3.AddComponent<CapsuleCollider>();
                    gameObject3.layer = 8;
                    gameObject3.transform.localScale = new Vector3(gameObject3.transform.localScale.x, 4f, gameObject3.transform.localScale.x);
                    gameObject3.transform.position = new Vector3(enemyposition[0], enemyposition[1], enemyposition[2]);
                    gameObject3.GetComponent<MeshRenderer>().material.color = new Color(1f, 0f, 0f);
                    this.EnemySpawnpoints.Add(gameObject3.transform);

                    i++;
                    break;

                case "!LevelEnd":
                    float[] finishposition = Array.ConvertAll(levelFile[i + 1].Split(new char[] { ' ' }), float.Parse);
					float[] finishscale = Array.ConvertAll(levelFile[i + 2].Split(new char[] { ' ' }), float.Parse);

                   this.FinishLevelTrigger.transform.position = new Vector3(finishposition[0], finishposition[1], finishposition[2]);
					this.FinishLevelTrigger.transform.localScale = new Vector3(finishscale[0], finishscale[1], finishscale[2]);
					

                    i += 2;
                    break;
            }
        }
			CalculateLevelHash();
			MFPEditorLogger.Log("Loading over");
		}

		// Token: 0x06000625 RID: 1573
		private IEnumerator CheckVersion()
		{
			UnityWebRequest www = UnityWebRequest.Get("https://fronkln.github.io/MFPLevelEditor/version.txt");
			yield return www.SendWebRequest();
			if (www.isNetworkError)
			{
				MFPEditorLogger.Log("couldnt get web data");
			}
			else if (float.Parse(www.downloadHandler.text) != LevelEditorInfo.version)
			{
				Application.OpenURL("https://fronkln.github.io/MFPLevelEditor/outdated.html");
			}
			yield break;
		}

		// Token: 0x06000626 RID: 1574
		private void Awake()
		{
			base.StartCoroutine(this.CheckVersion());
			File.WriteAllLines(MFPEditorLogger.logfile, new string[0]);
			MFPEditorLogger.Log("--------LEVELEDITOR SESSION STARTED--------");
			MFPEditorLogger.Log(DateTime.Now.ToString("MM/dd/yyyy HH:mm"));
			MFPEditorLogger.Log("------------------------------------------");
		}

		// Token: 0x06000627 RID: 1575
		protected string GetMD5HashFromFile(string fileName)
		{
			string result;
			using (MD5 md5 = MD5.Create())
			{
				using (FileStream stream = File.OpenRead(fileName))
				{
					result = BitConverter.ToString(md5.ComputeHash(stream)).Replace("-", string.Empty);
				}
			}
			return result;
		}

		// Token: 0x06000628 RID: 1576
		public void CalculateLevelHash()
		{
			string text = LevelEditorHandler.RemoveExcessCharacters(new string((from c in this.GetMD5HashFromFile(MFPEditorUtils.LoadFileFromDataFolder("Levels/default/level.txt"))
			where char.IsDigit(c) || c == '.' || c == ','
			select c).ToArray<char>()), 16);
			MFPEditorLogger.Log(text);
			ulong hashnumb = ulong.Parse(text);
			hashnumb = hashnumb % 150000UL + 200UL;
			MFPEditorLogger.Log(hashnumb.ToString());
			LevelEditorHandler.levelHash = (int)hashnumb;
			MFPEditorLogger.Log(LevelEditorHandler.levelHash.ToString());
		}

		// Token: 0x06000629 RID: 1577
		static LevelEditorHandler()
		{
		}

		// Token: 0x0600062A RID: 1578
		public static string RemoveExcessCharacters(string value, int maxLen)
		{
			if (value.Length <= maxLen)
			{
				return value;
			}
			return value.Substring(0, maxLen);
		}

		// Token: 0x060006DC RID: 1756
		public void AdjustPostProcessing(bool postProcessEnabled, float bloomIntensity)
		{
			if (postProcessEnabled)
			{
				this.Camera.GetComponent<PostProcessingBehaviour>().enabled = true;
				this.EditorCamera.GetComponent<PostProcessingBehaviour>().enabled = true;
				MFPEditorLogger.Log("Post processing is adjusted to be enabled");
			}
			else
			{
				this.Camera.GetComponent<PostProcessingBehaviour>().enabled = false;
				this.EditorCamera.GetComponent<PostProcessingBehaviour>().enabled = false;
				MFPEditorLogger.Log("Post processing is adjusted to be disabled");
			}
			this.allowPostProcess = postProcessEnabled;
			BloomModel.Settings custombloom = this.Camera.GetComponent<PostProcessingBehaviour>().profile.bloom.settings;
			custombloom.bloom.intensity = bloomIntensity;
			this.Camera.GetComponent<PostProcessingBehaviour>().profile.bloom.settings = custombloom;
		}

		// Token: 0x06000703 RID: 1795
		public void ToggleSettingsMenu(string menuType, bool forceOff)
		{
			if(this.Editing)
				ExitEditMode();

			if (forceOff)
			{
				this.WorldSettingsRoot.SetActive(false);
				this.EntitySpawnRoot.SetActive(false);
				this.adjustingSettings = false;
				return;
			}
			if (!this.adjustingSettings)
			{
				if (menuType == "world")
				{
					this.WorldSettingsRoot.SetActive(true);
					this.EntitySpawnRoot.SetActive(false);
					this.adjustingSettings = true;
					return;
				}
			}
			else
			{
				this.WorldSettingsRoot.SetActive(false);
				this.EntitySpawnRoot.SetActive(false);
				this.adjustingSettings = false;
			}
		}

		// Token: 0x04001338 RID: 4920
		public GameObject Player;

		// Token: 0x04001339 RID: 4921
		public GameObject Camera;

		// Token: 0x0400133A RID: 4922
		public GameObject HUD;

		// Token: 0x0400133B RID: 4923
		public GameObject RootShared;

		// Token: 0x0400133C RID: 4924
		public Camera EditorCamera;

		// Token: 0x0400133D RID: 4925
		public Text DebugObject;

		// Token: 0x0400133E RID: 4926
		public GameObject EditingObject;

		// Token: 0x0400133F RID: 4927
		public InputField CoordinateField;

		// Token: 0x04001340 RID: 4928
		public bool Editing;

		// Token: 0x04001341 RID: 4929
		private string editType = "position";

		// Token: 0x04001342 RID: 4930
		public static LevelEditorHandler Inst;

		// Token: 0x04001343 RID: 4931
		public Transform PlayerSpawn;

		// Token: 0x04001344 RID: 4932
		public bool PlayMod;

		// Token: 0x04001345 RID: 4933
		public GameObject EnemySample;

		// Token: 0x04001346 RID: 4934
		public List<GameObject> Enemies = new List<GameObject>();

		// Token: 0x04001347 RID: 4935
		public List<Transform> EnemySpawnpoints = new List<Transform>();

		// Token: 0x04001348 RID: 4936
		public bool fart;

		// Token: 0x04001349 RID: 4937
		public GameObject FinishLevelTrigger;

		// Token: 0x0400134A RID: 4938
		public RootScript root;

		// Token: 0x0400134B RID: 4939
		public Mesh EditorAxeMesh;

		// Token: 0x0400134C RID: 4940
		public GameObject EditAxes;

		// Token: 0x0400134D RID: 4941
		public bool spawnpoints_saved;

		// Token: 0x0400134E RID: 4942
		public List<GameObject> BrushLump = new List<GameObject>();

		// Token: 0x0400134F RID: 4943
		public Texture2D DefaultTexture;

		// Token: 0x04001350 RID: 4944
		public GameObject EditorButtonsRoot;

		// Token: 0x04001351 RID: 4945
		public GameObject EntitySpawnRoot;

		// Token: 0x04001352 RID: 4946
		public int theme = 1;

		// Token: 0x04001353 RID: 4947
		public bool allowPostProcess = true;

		// Token: 0x04001354 RID: 4948
		public static int levelHash = 55;

		// Token: 0x04001355 RID: 4949
		public static float levelTimer = 0f;

		// Token: 0x04001356 RID: 4950
		public static bool PlayerisDeadAndForceAutoLoad;

		// Token: 0x040013A2 RID: 5026
		public GameObject WorldSettingsRoot;

		// Token: 0x04001449 RID: 5193
		public bool adjustingSettings;

		// Token: 0x040014C3 RID: 5315
		public float bloomIntensity = 0.9f;


		public Toggle allowPostProcessToggle;

		// Token: 0x020000E2 RID: 226
		public enum CameraMode
		{
			// Token: 0x04001358 RID: 4952
			Disabled,
			// Token: 0x04001359 RID: 4953
			Enabled
		}
	}
}
