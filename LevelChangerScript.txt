using System;
using Jhrino.MFPLevelEditor;
using UnityEngine;
using UnityEngine.PostProcessing;
using UnityEngine.SceneManagement;
using UnityScript.Lang;
using  System.Linq;
using System.Collections;
using System.Collections.Generic;
using System.IO;

// Token: 0x02000063 RID: 99
[Serializable]
public class LevelChangerScript : MonoBehaviour
{
	// Token: 0x06000274 RID: 628 RVA: 0x00003499 File Offset: 0x00001699
	public LevelChangerScript()
	{
		this.levelNumber = 1;
		this.relative = true;
		this.saveState = true;
	}

	// Token: 0x06000275 RID: 629 RVA: 0x000034B6 File Offset: 0x000016B6
	public virtual void OnTriggerEnter(Collider col)
	{
		if (col.tag == "Player")
		{
			this.doTheThing();
		}
	}

	// Token: 0x06000276 RID: 630 RVA: 0x00036444 File Offset: 0x00034644
	public virtual void doTheThing()
	{
		if (this.dontShowEndScreen)
		{
			this.root.fadeToBlackAndChangeLevel();
		}
		else
		{
			this.root.levelEnded = true;
		}
		this.root.levelToLoad = ((!this.relative) ? this.levelNumber : (SceneManager.GetActiveScene().buildIndex + this.levelNumber));
	}


	public void Awake()
		{

		GameObject Bullet = Instantiate(GameObject.Find("Root").GetComponent<RootScript>().bullet);
		Bullet.name =  "CUSTOMBULLET";
		DontDestroyOnLoad(Bullet);
		GameObject.Find("Root").GetComponent<RootScript>().bullet = Bullet;

		}


	// Token: 0x06000277 RID: 631 RVA: 0x000364A4 File Offset: 0x000346A4
	public virtual void Start()
	{

		this.root = (RootScript)GameObject.Find("Root").GetComponent(typeof(RootScript));
		this.player = GameObject.Find("Player");
		this.Camera = GameObject.Find("Main Camera");
		this.HUD = GameObject.Find("HUD");
		UnityEngine.Object.DontDestroyOnLoad(this.root.gameObject);
		UnityEngine.Object.DontDestroyOnLoad(this.player);
		UnityEngine.Object.DontDestroyOnLoad(GameObject.Find("RootShared"));
		UnityEngine.Object.DontDestroyOnLoad(this.Camera);
		UnityEngine.Object.DontDestroyOnLoad(this.HUD);
		DontDestroyOnLoad(GameObject.Find("Enemy (1)"));
		DontDestroyOnLoad(GameObject.Find("Bullet"));
		this.Skybox = RenderSettings.skybox;
		base.Invoke("LevelEditorTest", 6f);
		UnityEngine.Object.DontDestroyOnLoad(GameObject.Find("Background Camera"));

		List<string> sceneobjs = new List<string>();


		foreach(GameObject gb in GameObject.FindObjectsOfType<GameObject>())
			{
				sceneobjs.Add(gb.name);
				
			}
		File.WriteAllLines("F:/steamapps2/steamapps/common/My Friend Pedro/jhrino_log.txt", sceneobjs.ToArray());


	}

	// Token: 0x06000278 RID: 632 RVA: 0x00036570 File Offset: 0x00034770
	public virtual void Update()
	{
		foreach(Transform teeh in GameObject.FindObjectsOfType<Transform>())
			{
			if(teeh.name.Contains("CUSTOMBULLET"))
				DontDestroyOnLoad(teeh);
			}

		if (Extensions.get_length(this.inputSwitch) > 0)
		{
			int num = -1;
			int i = 0;
			SwitchScript[] array = this.inputSwitch;
			int num2 = array.Length;
			while (i < num2)
			{
				if (array[i].output > (float)num)
				{
					num = (int)array[i].output;
				}
				i++;
			}
			if (num >= 1)
			{
				this.doTheThing();
			}
		}
	}

	// Token: 0x06000279 RID: 633 RVA: 0x000020A7 File Offset: 0x000002A7
	public virtual void Main()
	{
	}

	// Token: 0x0600027A RID: 634 RVA: 0x000365C4 File Offset: 0x000347C4
	public virtual void LevelEditorTest()
	{
		SceneManager.CreateScene("leveleditor_mod");
		SceneManager.UnloadScene(7);
		new GameObject().AddComponent<LevelEditorHandler>();
		this.player.transform.position = new Vector3(0f, 0f, 0f);
		new GameObject().name = "Level";
		GameObject gameObject = GameObject.CreatePrimitive(PrimitiveType.Cube);
		gameObject.transform.position = new Vector3(0f, -1f, 0f);
		gameObject.layer = 8;
		Camera camera = new GameObject().AddComponent<Camera>();
		camera.clearFlags = CameraClearFlags.Skybox;
		camera.depth = -2f;
		camera.transform.position = new Vector3(0f, 0f, 90f);
		camera.farClipPlane = 230f;
		this.Camera.transform.position = new Vector3(this.player.transform.position.x, this.player.transform.position.y, this.Camera.transform.position.z);
		this.Camera.GetComponent<PostProcessingBehaviour>().enabled = false;
		this.Camera.GetComponent<CameraScript>().fakePos = this.Camera.transform.position;
		this.Camera.GetComponent<CameraScript>().camPos = base.GetComponent<CameraScript>().fakePos;
		this.Camera.GetComponent<Camera>().clearFlags = CameraClearFlags.Color;
		this.root.bullet = GameObject.Find("Bullet");
		RenderSettings.skybox = new Material(Shader.Find("Skybox/6 Sided"));
	}

	// Token: 0x04000732 RID: 1842
	public SwitchScript[] inputSwitch;

	// Token: 0x04000733 RID: 1843
	private float switchInput;

	// Token: 0x04000734 RID: 1844
	public int levelNumber;

	// Token: 0x04000735 RID: 1845
	public bool relative;

	// Token: 0x04000736 RID: 1846
	public bool saveState;

	// Token: 0x04000737 RID: 1847
	public bool dontShowEndScreen;

	// Token: 0x04000738 RID: 1848
	private RootScript root;

	// Token: 0x04000739 RID: 1849
	public GameObject player;

	// Token: 0x0400073A RID: 1850
	public GameObject HUD;

	// Token: 0x0400073B RID: 1851
	public GameObject Camera;

	// Token: 0x0400073C RID: 1852
	public Material Skybox;
}
